
###############################################################################
# Model for ASF in German wild boar
#
# Formatting notes:
#   - use camel case, no periods or underscores when naming objects
#   - all objects begin with lower case letter, except use uppercase for first
#     letter of function names
#   - use descriptive names for objects
#     e.g. 'mortalityProb' rather than 'mp'
#   - indent should be two spaces
#   - use spaces around mathematical operators, except when specifying function
#     arguments or when indexing with vector or matrix e.g. matrix[1:(x+1), ]
#   - reference columns of any matrix by name rather than index number
#   - wrap lines of code longer than 79 characters (width of the # bars)
###############################################################################



rm(list=ls())

#install.packages("triangle")
require("triangle")

set.seed(1)




###############################################################################
# Input Section

# Inputs for initial population
initialAbundance <- 200
initialAdultFemales <- round(.25 * initialAbundance)
initialJuvFemales   <- round(.24 * initialAbundance)
initialAdultMales   <- round(.21 * initialAbundance)
initialJuvMales     <- initialAbundance - 
                       sum(initialAdultFemales + initialJuvFemales + 
                           initialAdultMales)
maxFemalesPerSounder <- 7
initPigletsPerSounder <- 15

traitList <- c( 'id', 'sounderId', 'location', 'age', 'female', 'mortProb')

###############################################################################











###############################################################################
# Functions

  # create empty matrix
  popMatrix <- matrix(0, nrow=initialAbundance, ncol=length(traitList))
  colnames(popMatrix) <- traitList

  # assign id numbers
  popMatrix[, "id"] <- seq(1:nrow(popMatrix))

  # assign sex
  popMatrix[1:(initialAdultFemales + initialJuvFemales), 'female'] <- 1

  # assign age to adult females
  popMatrix[1:initialAdultFemales, "age"] <-
    round(rtriangle(initialAdultFemales, a=(19*30), b=(96*30), c=(19*30)))

  # assign age to juv females
  ageSeq <- c(rep(sample((30*7):(30*10), 
                         initialJuvFemales%/%3, replace=TRUE), 3),
              rep(sample((30*7):(30*10), 1), initialJuvFemales%%3))
  popMatrix[(initialAdultFemales+1):
            (initialAdultFemales+initialJuvFemales),"age"] <- ageSeq
  
  # assign age to adult males
  popMatrix[(initialAdultFemales+initialJuvFemales + 1):
            (initialAbundance-initialJuvMales), "age"] <- 
    round(rtriangle(initialAdultMales, a=(19*30), b=(72*30), c=(19*30)))
  
  # assign ages to juv males
  ageSeq <- c(rep(sample((30*7):(30*10), 
                         initialJuvMales%/%3, replace=TRUE), 3),
              rep(sample((30*7):(30*10), 1), initialJuvMales%%3))
  popMatrix[(initialAbundance-initialJuvMales+1):
            initialAbundance, "age"]<- ageSeq  

  # assign sounder id's to adult solo males
  soloMales <- sum(popMatrix[ , "female"] == 0 & 
                   popMatrix[ , "age"] > (18*30))
  popMatrix[popMatrix[ , "female"] == 0 & 
            popMatrix[ , "age"] > (18*30), "sounderId"] <- seq(1, soloMales)

  # assign sounder id's to adult females
  # JORDAN: I replaced your loop with this. Sorry!
  for(i in 1:initialAdultFemales) {
    popMatrix[i, "sounderId"] <- soloMales + (i-1) %/% maxFemalesPerSounder
  }
  idFill <- 1 + soloMales + (i-1) %/% maxFemalesPerSounder
  
  



## Juveniles
# Necesscary objects for loop
#idFill         <- soloMales + 1
#juvFemRow      <- initialAdultFemales + 1
#juvMaleRow     <- initialAdultFemales + initialJuvFemales + initialAdultMales + 1 
#juvFemEndRow   <- initialAdultFemales + initialJuvFemales
#juvMaleEndRow  <- initialAbundance
#spotsRemaining <- initPigletsPerSounder
#m <- juvMaleRow  
#f <- juvFemRow
#outOfMalePiglets <- 0
#outOfFemalePiglets <- 0
#stop <- 0


# Starting "outer" while loop

#while (outOfMalePiglets + outOfFemalePiglets != 2) {
# Starting "inner" While Loop
  #while (stop==0 & spotsRemaining > 0) {
    #if (spotsRemaining==1 & (outOfMalePiglets + outOfFemalePiglets==0)) {
      #stop <- 1
      #draw <- runif(1)
      #if (draw > 0.5) {
        #popMatrix[, "sounderId"][f]  <- idFill
        #f <- min(f+1, juvFemEndRow)
    #  } # Close second if statement 
      #else {
        #popMatrix[, "sounderId"][m] <- idFill
        #m <- min(m+1, juvMaleEndRow)
      #} # Close else statment 
    #} else { 
      #popMatrix[, "sounderId"][f] <- idFill
      #popMatrix[, "sounderId"][m] <- idFill
      #spotsRemaining <- numPiglets - (sum(popMatrix[, "sounderId"]==idFill))
      #if (m == juvMaleEndRow){
        #outOfMalePiglets <- 1
    #  } # Close if statement
      #if (f == juvFemEndRow){
        #outOfFemalePiglets <- 1
   #   } # Close if statement
      #if (outOfMalePiglets + outOfFemalePiglets==2){
        #stop <- 1
      #}
      #m <- min(m+1, juvMaleEndRow)
      #f <- min(f+1, juvFemEndRow)
  #  } # close else statement
    
 # } # Close While Loop
   
  #spotsRemaining <- initPigletsPerSounder 
  #idFill <- idFill + 1
  #stop <- 0
#} # Close Outer While Loop

#InitialPopulation <- function() {
#  # this functions returns an initial popMatrix
#
#
#  return(popMatrix)
#}

###############################################################################



###############################################################################
# Loops

#popMatrix <- InitialPopulation()

#for(d in 1:365) {
#  popMatrix <- Mortality()
#  popMatrix <- Reproduction()
#}


###############################################################################
